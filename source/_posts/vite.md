---
title: vite介绍
tag: vite介绍
categories:
  - 打包工具
---

## vite的优势

* 更快的启动和热更新
* vite将代码分为“源码”和“依赖”，依赖使用esbuild进行打包，并使用强制缓存；源码依赖于浏览器支持ESM机制，直接通过http请求
  进行按需加载，并使用协商缓存

## vite的缺点

* 首屏加载慢
  * 因为没有对文件进行bundle操作，包括（tree-shaking等）会导致大量的http请求
  * dev服务期间会对文件进行转换操作，需要时间,尽管预构建很快，但是会阻塞首屏加载
  * vite需要把webpack dev启动完成的工作，移接到浏览器中，导致浏览器响应时间变长；但由于缓存的存在，在第一次加载完成后，再次
    reload的时候性能变好很多
* 懒加载慢
  * 和首屏加载一样，动态加载文件需要对源文件进行转换操作，可能会出现大量的http情趣，懒加载性能受到影响

## vite什么生产上仍需要打包

因为源码如何存在多层依赖嵌套，会影响性能，相当于绕远路；还是需要进行tree-shaking、懒加载、chunk分割

## 为什么在生产构建时不使用esbuild

vite现在的插件和esbuild存在不兼容的情况，
后期会使用rolldowm、rollup_swc(speed web compile)

## webpack和vite构建原理

* vite不会打包所有源码，而是基于路由的代码拆分知道实际需要哪些部分，浏览器请求文件时再进行转换；
  开发构建分为依赖和源码，依赖使用esbuild预构建，源码则利用浏览器支持esm模式基础上，让浏览器承担打包工作
  通过http的形式获取各个资源，vite再对获取的资源进行转换处理
* webpack会在内部构建依赖图，从入口开始，逐级递归识别依赖，构建依赖图谱；分析代码、转化代码、编译代码、输入打包后的代码
